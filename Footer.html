<style>
  .footer-section {
    margin-top: 50px;
    padding: 20px 0;
    text-align: center;
    border-top: 1px solid #dee2e6;
    color: #6c757d;
  }

  .footer-section a {
    color: #dc3545;
    text-decoration: none;
    font-weight: bold;
  }

  .footer-section a:hover {
    text-decoration: underline;
  }
</style>

<footer class="footer-section">
  <div class="container">
    <p>
      <i class="fas fa-comment-dots"></i>
      對系統有任何建議嗎？
      <a href="<?!= getScriptUrl() ?>?page=Suggest" target="_blank">提交意見</a>
    </p>
    <small>&copy; 2026 舒漾居家長照服務管理系統</small>
  </div>
</footer>

<script>
/**
      * 呼叫後端同步權限功能
      */
    function syncPermissions() {
      // 檢查 Swal 是否存在，避免再次報錯
      if (typeof Swal === 'undefined') {
        alert("系統錯誤：尚未載入 SweetAlert2 函式庫");
        return;
      }

      // 1. 關閉 Offcanvas 導覽列
      var offcanvasElement = document.querySelector('.offcanvas');
      if (offcanvasElement) {
        var offcanvas = bootstrap.Offcanvas.getInstance(offcanvasElement);
        if (offcanvas) offcanvas.hide();
      }

      // 2. 啟動 SweetAlert2 動態效果
      Swal.fire({
        title: '同步權限中',
        text: '正在更新所有試算表權限，並清理名單，請稍候...',
        allowOutsideClick: false,
        showConfirmButton: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      // 3. 呼叫 GAS 後端
      google.script.run
        .withSuccessHandler(function () {
          Swal.fire({
            icon: 'success',
            title: '同步完成',
            text: '權限已成功更新',
            timer: 2000
          });
        })
        .withFailureHandler(function (err) {
          Swal.fire({
            icon: 'error',
            title: '同步失敗',
            text: err.message
          });
        })
        .syncMasterTablePermissions();
    }

    function runManualMaintenance() {
      // 1. 關閉導航列
      var offcanvasElement = document.querySelector('.offcanvas');
      var bsOffcanvas = bootstrap.Offcanvas.getInstance(offcanvasElement);
      if (bsOffcanvas) bsOffcanvas.hide();

      // 2. 顯示讀取中
      Swal.fire({
        title: '資料處理中',
        text: '正在遷移過期紀錄並同步 User 名單，若有新年度檔案將自動設定權限...',
        allowOutsideClick: false,
        didOpen: () => { Swal.showLoading(); }
      });

      // 3. 呼叫後端函式
      google.script.run
        .withSuccessHandler(function () {
          Swal.fire('完成', '資料維護與 User 同步已執行完畢。', 'success');
        })
        .withFailureHandler(function (err) {
          Swal.fire('執行失敗', err.message, 'error');
        })
        .dailyMaintenanceJob(); // 執行剛才寫的後端主函式
    }
    </script>